{% extends "crowdfunding/base.html" %}

{% block scripts %}
    <script type="text/javascript">
    $(function(){
        $('#description_tab').click(function(){
            $('.update_content').fadeOut();
            $('.description_content').fadeIn();
            $('#updates_tab').removeClass('selected');
            if(!$(this).hasClass('selected'))
                $('#description_tab').addClass('selected');
        });
        $('#updates_tab').click(function(){
            $('.description_content').fadeOut();
            $('.update_content').fadeIn();
            $('#description_tab').removeClass('selected');
            if(!$(this).hasClass('selected'))
                $('#updates_tab').addClass('selected');
        });

        $('#back_this_project_button').click(function() {
            $('#login_modal a').attr('href', $('#login_modal a').attr('href') + '?next=/crowdfunding/project/{{project.id}}');
            $('#login_modal').foundation('reveal', 'open');
        });

        $('#pledge_submit').click(function() {
            if($(this).hasClass('disabled')) return;
            $(this).addClass('disabled').siblings('img.loading').show();
            $.post($('#pledge_form form').attr('action'), $('#pledge_form form').serialize(), function(response) {
                if(response.success == 'true')
                {
                    window.location.reload();
                }
                else
                {
                    $('#pledge_form p.errors').html('Could not submit pledge. ');
                    for(var i=0; i<response.errors.length; i++)
                    {
                        $('#pledge_form p.errors').append(response.errors[i] + '. ');
                    }
                    $('#pledge_form p.errors').show();
                    $('#pledge_submit').removeClass('disabled').siblings('img.loading').hide();
                }
            });
        });
        $('#crowdfunding_project_detail_page p#already_pledged_message a').click(function() {
            $('#pledge_form').removeClass('hidden');
            $('#already_pledged_message').addClass('hidden');
        });
    });
    </script>
    <LINK rel="stylesheet" type="text/css" href="{{STATIC_URL}}js/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}js/slick/slick-theme.css"/>
{% endblock scripts %}

{% block content %}
    <div id="crowdfunding_project_detail_page">
        <div id="hero_content">
            <div class="row">
                <div class="large-6 column" id="project_image_container">
                <div class="cover-images">
                        {% for project_image in project.project_images.all %}
                            <div>
                                <img src="{{project_image.image.url}}">
                            </div>
                        {% endfor %} 
                </div>
                </div>
                <div class="large-6 column">
                    <div id="project_title">{{project.title}}</div>
                    <div id="project_summary">{{project.summary}}</div>
                    <div>
                        <div class="column project_progress progress nice large-10">
                            <span class="meter" style="width:{{project.get_percentage_pledged}}%"></span>
                        </div>
                        <div class="row">
                            <div class="large-4 small-4 medium-4 column">
                              <div class="project_metric_number">{{project.get_percentage_pledged}}%</div>
                              <div class="project_metric_label">Pledged</div>
                            </div>
                            <div class="large-4 small-4 medium-4 column">
                              <div class="project_metric_number">Rs.{{project.goal}}</div>
                              <div class="project_metric_label">Goal</div>
                            </div>
                            <div class="large-4 small-4 medium-4 column">
                              <div class="project_metric_number">{{project.get_days_remaining}} Days</div>
                              <div class="project_metric_label">To go</div>
                            </div>
                          </div>  
                    </div>
                    {% if not user.is_authenticated %}
                    <div class="button need_login" id="back_this_project_button">BACK THIS PROJECT</div>
                    {% else %}
                    <p id="already_pledged_message" {% if not user_pledge %}class="hidden"{% endif %}><span>You have pledged Rs. {{user_pledge.amount}} to this project. </span><a href="#">Edit pledge</a></p>
                    <div id="pledge_form" {% if user_pledge %}class="hidden"{% endif %}>
                        <form method="POST" action="/crowdfunding/_pledge/create">{% csrf_token %}
                            <input type="hidden" name="project_id" value="{{project.id}}">
                            <input type="text" placeholder="Enter pledge amount(Rs)" name="amount" id="pledge_amount" value="{{user_pledge.amount}}">
                            <div class="btn" id="pledge_submit">Pledge</div>
                            <img src="{{STATIC_URL}}newimg/spinner_transparent.gif" class="loading">
                            <p class="errors">Could not submit pledge</p>
                        </form>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="row">
            <div id="thumbnails" class="column large-6 medium-12 small-12">
                
            </div>
            <div id="disclaimer" class="column large-6 medium-12 small-12">
                *Campaign initiated on {{project.start_date}}
            </div>
        </div>
        <div class="row" id="detail_content">
            <div class="column large-6 large-offset-1">
                <div class="row project_content_title">
                    <div class="column">
                        {{project.title}}
                    </div>
                </div>
                <div class="row" id="project_content_nav">
                <div class="large-6 column project_nav_container">
                    <div class="column large-6 project_content_nav_item selected" id="description_tab">Description</div>
                    <div class="column large-6 project_content_nav_item" id="updates_tab">Updates</div>
                </div>
                </div>
                    <div class="row update_content">
                        {% for update in project.updates.all %}
                        <div class="row update_item">
                            <div class="column large-6">
                                <!--span class="project_update_title">TEST SUCCESS</span-->
                                <span class="project_update_date">{{update.timestamp}}</span>
                            </div>
                            <div class="column large-12">
                                {{update.update|safe}}
                            </div>
                        </div>
                        {% endfor %}
                    </div> 
                    <div class="row description_content">
                        <div class="large-12 column">
                            {{project.description|safe}}
                        </div>
                    </div>
            </div>
            <div class="column large-4 large-offset-1">
                <div class="row project_content_title">TEAM</div>
                <div class="row team_members">{{project.team|safe}}</div>
                <!--div class="row">
                    <div id="team_member_container">
                        <img id="team_member_pic" src="{{STATIC_URL}}newimg/barack.png">
                        <span>Barack Obama</span>
                    </div>
                    <div id="team_member_container">
                        <img id="team_member_pic" src="{{STATIC_URL}}newimg/barack.png">
                        <span>Barack Obama</span>
                    </div>
                    <div id="team_member_container">
                        <img id="team_member_pic" src="{{STATIC_URL}}newimg/barack.png">
                        <span>Barack Obama</span>
                    </div>
                    <div id="team_member_container">
                        <img id="team_member_pic" src="{{STATIC_URL}}newimg/barack.png">
                        <span>Barack Obama</span>
                    </div>
                    <div id="team_member_container">
                        <img id="team_member_pic" src="{{STATIC_URL}}newimg/barack.png">
                        <span>Barack Obama</span>
                    </div>
                </div-->
            </div>
        </div>
    <div id="crowdfunding_projects_section" class="content-width">
    <div id="crowdfunding_project_grid" class="row">
    {% for related_project in related_projects %}
    <div class="column large-4 medium-6 small-12 project_block_container">
    <a href="./{{related_project.id}}">
      <div class="project_block row">
        <div class="project_image_container">
          <img class="project_image" src="{{related_project.get_primary_picture_url}}">
        </div>
          <div class="project_content">
            <div class="project_content_heading column">{{related_project.title}}</div>
            <div class="project_content_summary column">{{related_project.summary}}</div>
          </div>
          <div class="project_numbers column">
            <div class="column project_progress progress nice large-12">
                <span class="meter" style="width:{{related_project.get_percentage_pledged}}%"></span>
            </div>
          </div>
          <div class="column">
            <div class="large-4 small-4 medium-4 column">
              <div class="project_metric_number">{{related_project.get_percentage_pledged}}%</div>
              <div class="project_metric_label">Funded</div>
            </div>
            <div class="large-4 small-4 medium-4 column">
              <div class="project_metric_number">Rs.{{related_project.goal}}</div>
              <div class="project_metric_label">Goal</div>
            </div>
            <div class="large-4 small-4 medium-4 column project_days_container">
              <div class="project_metric_number">{{related_project.get_days_remaining}} Days</div>
              <div class="project_metric_label">Remaining</div>
            </div>
          </div>
      </div>
      </a>
    </div>
    {% endfor %}

    </div>
  </div>
    </div>
    <script type="text/javascript" src="{{STATIC_URL}}js/slick/slick.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
          $('.cover-images').slick({dots: true,
                                    infinite: true,
                                    });
        });
    </script>
{% endblock content %}